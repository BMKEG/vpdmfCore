<ViewDefinition Name="PhysiologyExperiment" Type="Data">
	<Primitives>

<!--  TOP PRIMITIVE -->

		<PrimitiveDefinition Name="PhysiologyExperiment" primaryFlag="TRUE">
			<Classes>
				<Class Name="KnowledgeStatement" primaryFlag="TRUE"/>
				<Class Name="PhysiologyExperiment"/>
			</Classes>
			<FormDesign>
				<Control Type="Wizard" Pos="0" Label="Experiment Name" baseClass="edu.usc.kmrg.vpdmf.knowledgeCapture.experiments.PhysiologyExperiment" attributeAddress="]PhysiologyExperiment|ViewTable.ViewTable_id"/>
				<Control Type="TextInput" Pos="1" Label="Name" Size="40" attributeAddress="]PhysiologyExperiment|PhysiologyExperiment.name"/>
				<Control Type="Lookup" Pos="2" Label="Atlas" lookupView="AtlasLU" attributeAddress="]Atlas|ViewTable.indexString"/>
                        	<GridArray Pos="3" Label="Non-Neural Stimulus" attributeAddress="]NonNeuralStimulus">
			        	<Control Type="Lookup" Pos="3.1" Label="Type" lookupView="NonNeuralStimulusType" removeTerm="0" attributeAddress="]NonNeuralStimulusType|CV.name"/>
                                      	<Control Type="TextRegion" Pos="3.2" Height="3" Width="20" Label="Description" attributeAddress="]NonNeuralStimulusType|CV.description"/>
				</GridArray>
				<Control Type="Lookup" Pos="4" Label="Stimulus Intensity" lookupView="NonNeuralStimulusIntensity" attributeAddress="]NonNeuralStimulusIntensity|LookupDatum.indexString"/>
		        	<GridArray Pos="5" Label="Stimulus Duration" attributeAddress="]NonNeuralStimulusDuration">
                                	<Control Type="TextInput" Pos="5.1" Size="15" Label="time" attributeAddress="]NonNeuralStimulusDuration|LookupDatum.value"/>
                                	<Control Type="TextInput" Pos="5.2" Size="15" Label="(error)" attributeAddress="]NonNeuralStimulusDuration|LookupDatum.error"/>
                                        <Control Type="Lookup" Pos="5.3" Label="units" lookupView="NonNeuralStimulusDurationDefinition" attributeAddress="]NonNeuralStimulusDurationDefinition|DataDefinition.units"/>
                                </GridArray>
		        	<GridArray Pos="6" Label="Neural Intervention" attributeAddress="]NeuralStimulusType">
			        	<Control Type="Lookup" Pos="6.1" Label="Type" lookupView="NeuralStimulusType" removeTerm="0" attributeAddress="]NeuralStimulusType|CV.name"/>
                                      	<Control Type="TextRegion" Pos="6.2" Height="3" Width="20" Label="Description" attributeAddress="]NeuralStimulusType|CV.description"/>
				</GridArray>
				<GridArray Pos="7" Label="Atlas Areas involved in[br]Neural Intervention" attributeAddress="]StimulusAtlasVolume">
					<Control Type="Lookup" Pos="7.1" Label="Atlas Volume" lookupView="StimAtlasVolumeLU" attributeAddress="]StimAtlasVolumeLU|ViewTable.indexString"/>
					<Control Type="Lookup" Pos="7.2" Label="Participation Relation" lookupView="ParticipationRelation" attributeAddress="]ParticipationRelation|CV.indexString"/>
					<Control Type="Lookup" Pos="7.3" Label="Hemisphere" lookupView="HemisphereRelation" attributeAddress="]HemisphereRelation|CV.indexString"/>
				</GridArray>
				<GridArray Pos="8" Label="Type" attributeAddress="]NeuralSignalType">
					<Control Type="Lookup" Pos="8.1" Label="Signal Type" lookupView="NeuralSignalType" removeTerm="0" attributeAddress="]NeuralSignalType|CV.name"/>
					<Control Type="TextRegion" Pos="8.2" Height="3" Width="30" Label="Description" attributeAddress="]NeuralSignalType|CV.description"/>
			        </GridArray>
				<GridArray Pos="10" Label="Time after exposure" attributeAddress="]SignalTime">
	                                <Control Type="TextInput" Pos="10.1" Size="15" attributeAddress="]SignalTime|LookupDatum.value"/>
        	                        <Control Type="TextInput" Pos="10.2" Size="15" Label="(error)" attributeAddress="]SignalTime|LookupDatum.error"/>
                	                <Control Type="Lookup" Pos="10.3" Label="units" removeTerm="1" lookupView="SignalTimeDefinition" attributeAddress="]SignalTimeDefinition|DataDefinition.units"/>
			        </GridArray>
				<GridArray Pos="11" Label="Atlas Area displaying [br]neural signal" attributeAddress="]SignalAtlasVolume">
					<Control Type="Lookup" Pos="11.1" Label="Atlas Volume" lookupView="SigAtlasVolumeLU" attributeAddress="]SigAtlasVolumeLU|ViewTable.indexString"/>
					<Control Type="Lookup" Pos="11.2" Label="Signal Strength" lookupView="SignalStrength" attributeAddress="]SignalStrength|LookupDatum.indexString"/>
					<Control Type="Lookup" Pos="11.3" Label="Pattern" lookupView="PatternRelation" attributeAddress="]PatternRelation|CV.indexString"/>
					<Control Type="Lookup" Pos="11.4" Label="Topography" lookupView="TopographyRelation" attributeAddress="]TopographyRelation|CV.indexString"/>
					<Control Type="Lookup" Pos="11.5" Label="Hemisphere" lookupView="Hemi2Relation" attributeAddress="]Hemi2Relation|CV.indexString"/>
				</GridArray>
                                <GridArray Pos="12" Label="Response" attributeAddress="]ResponseType">
					<Control Type="Lookup" Pos="12.1" Label="Response Type" lookupView="ResponseType" attributeAddress="]ResponseType|CV.name"/>
					<Control Type="TextRegion" Pos="12.2" Height="3" Width="30" Label="Description" attributeAddress="]ResponseType|CV.description"/>
				</GridArray>
			</FormDesign>
			<triplets>
				<triplet>KnowledgeStatement->knowledgeType=KnowledgeType|CV</triplet>
				<triplet>KnowledgeStatement->statementFormat=StatementFormat|CV</triplet>
				<triplet>PhysiologyExperiment->exptType=ExperimentalType|CV</triplet>
				<triplet>PhysiologyExperiment->neuralSignal=NeuralSignal|NeuralSignal</triplet>
				<triplet>PhysiologyExperiment->neuralStimulus=NeuralStimulus|NeuralStimulus</triplet>
				<triplet>PhysiologyExperiment->nonNeuralStimulus=NonNeuralStimulus|NonNeuralStimulus</triplet>
				<triplet>PhysiologyExperiment->response=Response|Response</triplet>
                		<triplet>PhysiologyExperiment->atlas=AtlasLU|Atlas</triplet>
			</triplets>
                </PrimitiveDefinition>
		<PrimitiveDefinition Editable="0" Nullable="1" lookupView="AtlasLU"/>

<!--  'DATA' DEPENDENT PRIMITIVES *** Non Neural Stimulus -->

                <PrimitiveDefinition Name="NonNeuralStimulus">
			<Classes>
				<Class Name="ViewTable" primaryFlag="TRUE"/>
				<Class Name="NonNeuralStimulus"/>
			</Classes>
			<Conditions>
				<Condition>
					|ViewTable.viewType='.NonNeuralStimulus.%'
				</Condition>
			</Conditions>
        	    	<triplets>
            			<triplet>NonNeuralStimulus->nonNeuralStimulusType=NonNeuralStimulusType|CV</triplet>
            			<triplet>NonNeuralStimulus->stimulusDuration=NonNeuralStimulusDuration|LookupDatum</triplet>
            			<triplet>NonNeuralStimulus->stimulusIntensity=NonNeuralStimulusIntensity|CV</triplet>
              		</triplets>
		</PrimitiveDefinition>

<!--  'DATA' DEPENDENT PRIMITIVES *** Response -->

                <PrimitiveDefinition Name="Response">
			<Classes>
				<Class Name="ViewTable" primaryFlag="TRUE"/>
				<Class Name="Response"/>
			</Classes>
			<Conditions>
				<Condition>
					|ViewTable.viewType='.Response.%'
				</Condition>
			</Conditions>
        	    	<triplets>
            			<triplet>Response->responseType=ResponseType|CV</triplet>
              		</triplets>
		</PrimitiveDefinition>

<!--  'DATA' DEPENDENT PRIMITIVES *** Neural Stimulus -->

                <PrimitiveDefinition Name="NeuralStimulus">
			<Classes>
				<Class Name="ViewTable" primaryFlag="TRUE"/>
				<Class Name="SpatialPrimitive"/>
                		<Class Name="NeuralStimulus"/>
			</Classes>
			<Conditions>
				<Condition>
					|ViewTable.viewType='.SpatialPrimitive.%.BrainVolume.%.NeuralStimulus.%'
				</Condition>
			</Conditions>
			<triplets>
			        <triplet>NeuralStimulus->nStimType=NeuralStimulusType|CV</triplet>
			        <triplet>NeuralStimulus->stimAV=StimulusAtlasVolume|StimulusAtlasVolume</triplet>
			</triplets>
		</PrimitiveDefinition>
		<PrimitiveDefinition Name="StimulusAtlasVolume">
			<Classes>
				<Class Name="StimulusAtlasVolume" primaryFlag="TRUE"/>
			</Classes>
			<triplets>
            			<triplet>StimulusAtlasVolume->stimAV=StimAtlasVolumeLU|AtlasVolume</triplet>
                		<triplet>StimulusAtlasVolume->participation=ParticipationRelation|CV</triplet>
		                <triplet>StimulusAtlasVolume->stimulusHemisphere=HemisphereRelation|CV</triplet>
			</triplets>
		</PrimitiveDefinition>

<!--  'DATA' DEPENDENT PRIMITIVES *** Neural Signal -->

                <PrimitiveDefinition Name="NeuralSignal">
			<Classes>
				<Class Name="ViewTable" primaryFlag="TRUE"/>
				<Class Name="SpatialPrimitive"/>
                		<Class Name="NeuralSignal"/>
			</Classes>
			<Conditions>
				<Condition>
					|ViewTable.viewType='.SpatialPrimitive.%.DataMap.%.NeuralSignal.%'
				</Condition>
			</Conditions>
			<triplets>
			        <triplet>NeuralSignal->timeAfterExposure=SignalTime|LookupDatum</triplet>
				<triplet>NeuralSignal->sigAV=SignalAtlasVolume|SignalAtlasVolume</triplet>
       	         		<triplet>NeuralSignal->sigType=NeuralSignalType|CV</triplet>
			</triplets>
		</PrimitiveDefinition>
		<PrimitiveDefinition Name="SignalAtlasVolume">
			<Classes>
				<Class Name="SignalAtlasVolume" primaryFlag="TRUE"/>
			</Classes>
			<triplets>
            			<triplet>SignalAtlasVolume->sigAV=SigAtlasVolumeLU|AtlasVolume</triplet>
                		<triplet>SignalAtlasVolume->signalStrength=SignalStrength|CV</triplet>
		                <triplet>SignalAtlasVolume->pattern=PatternRelation|CV</triplet>
		                <triplet>SignalAtlasVolume->topography=TopographyRelation|CV</triplet>
		                <triplet>SignalAtlasVolume->signalHemisphere=Hemi2Relation|CV</triplet>
			</triplets>
		</PrimitiveDefinition>

<!--  PRESET TYPES -->

        	<PrimitiveDefinition Editable="0" Nullable="1" lookupView="StatementFormat">
			<Conditions>
				<Condition>
					|CV.name='Computer: VPDMf'
				</Condition>
			</Conditions>
		</PrimitiveDefinition>
		<PrimitiveDefinition Editable="0" Nullable="1" lookupView="KnowledgeType">
			<Conditions>
				<Condition>
					|CV.name='capture'
				</Condition>
			</Conditions>
		</PrimitiveDefinition>
		<PrimitiveDefinition Editable="0" Nullable="1" Name="ExperimentalType">
			<Classes>
				<Class Name="CV" primaryFlag="TRUE"/>
			</Classes>
			<Conditions>
				<Condition>
					|CV.name='Physiological'
				</Condition>
			</Conditions>
		</PrimitiveDefinition>

<!--  EDITABLE TYPES -->

                <PrimitiveDefinition Editable="1" Nullable="1" lookupView="NeuralStimulusType"/>
                <PrimitiveDefinition Editable="1" Nullable="1" lookupView="ResponseType"/>
                <PrimitiveDefinition Editable="1" Nullable="1" lookupView="NeuralSignalType"/>
                <PrimitiveDefinition Editable="1" Nullable="1" lookupView="NonNeuralStimulusType"/>

<!--  Neural Signal  -->
	        <PrimitiveDefinition Editable="0" Name="SigAtlasVolumeLU" lookupView="AtlasVolumeLU"/>
        	<PrimitiveDefinition Editable="0" lookupView="TopographyRelation"/>
	    	<PrimitiveDefinition Editable="0" lookupView="PatternRelation"/>
	    	<PrimitiveDefinition Editable="0" lookupView="SignalStrength"/>
        	<PrimitiveDefinition Editable="0" Name="Hemi2Relation" lookupView="HemisphereRelation"/>

		<PrimitiveDefinition Name="SignalTime">
			<Classes>
				<Class Name="LookupDatum" primaryFlag="TRUE"/>
			</Classes>
			<triplets>
				<triplet>
					LookupDatum->def=SignalTimeDefinition|DataDefinition
				</triplet>
			</triplets>
		</PrimitiveDefinition>
		<PrimitiveDefinition Name="SignalTimeDefinition" lookupView="TimeDefinition"/>

<!--  Neural Stimulus  -->
        	<PrimitiveDefinition Editable="0" Name="StimAtlasVolumeLU" lookupView="AtlasVolumeLU"/>
		<PrimitiveDefinition Editable="0" lookupView="ParticipationRelation"/>
        	<PrimitiveDefinition Editable="0" lookupView="HemisphereRelation"/>

<!--  Non-Neural Stimulus  -->

<!--  (1) Stimulus Duration -->
		<PrimitiveDefinition Name="NonNeuralStimulusDuration">
			<Classes>
				<Class Name="LookupDatum" primaryFlag="TRUE"/>
			</Classes>
			<triplets>
				<triplet>
					LookupDatum->def=NonNeuralStimulusDurationDefinition|DataDefinition
				</triplet>
			</triplets>
		</PrimitiveDefinition>
		<PrimitiveDefinition Name="NonNeuralStimulusDurationDefinition" lookupView="TimeDefinition"/>

<!--  (2) Stimulus Intensity-->
		<PrimitiveDefinition lookupView="NonNeuralStimulusIntensity"/>
	</Primitives>

<!--  Only links to subsidiary data ... what about atlas? What do we need to copy over? -->

	<Links>
		<Link Name="NeuralSignal" setRelation="ReverseDependent">[PhysiologyExperiment]PhysiologyExperiment|PhysiologyExperiment=[NeuralSignal]PhysiologyExperimentLU|PhysiologyExperiment,[PhysiologyExperiment]NeuralSignal|NeuralSignal=[NeuralSignal]NeuralSignal|NeuralSignal</Link>
		<Link Name="NeuralStimulus" setRelation="ReverseDependent">[PhysiologyExperiment]PhysiologyExperiment|PhysiologyExperiment=[NeuralStimulus]PhysiologyExperimentLU|PhysiologyExperiment,[PhysiologyExperiment]NeuralStimulus|NeuralStimulus=[NeuralStimulus]NeuralStimulus|NeuralStimulus</Link>
		<Link Name="NonNeuralStimulus" setRelation="Overlap">[PhysiologyExperiment]PhysiologyExperiment|PhysiologyExperiment=[NonNeuralStimulus]PhysiologyExperimentLU|PhysiologyExperiment,[PhysiologyExperiment]NonNeuralStimulus|NonNeuralStimulus=[NonNeuralStimulus]NonNeuralStimulus|NonNeuralStimulus</Link>
		<Link Name="Response" setRelation="Overlap">[PhysiologyExperiment]PhysiologyExperiment|PhysiologyExperiment=[Response]PhysiologyExperimentLU|PhysiologyExperiment,[PhysiologyExperiment]Response|Response=[Response]Response|Response</Link>
	</Links>

<!--  Try a simple index to start with  -->

	<Index Format="$1$"/>
	<MachineIndex Format="$1$"/>
	<IndexElements>
		<IndexElement Pos="1" attributeAddress="]PhysiologyExperiment|PhysiologyExperiment.name"/>
		<IndexElement Pos="2" Nullable="1" attributeAddress="]NeuralSignal|SpatialPrimitive.name"/>
		<IndexElement Pos="3" Nullable="1" attributeAddress="]NeuralStimulus|SpatialPrimitive.name"/>
		<IndexElement Pos="4" Nullable="1" attributeAddress="]NonNeuralStimulusType|CV.name"/>
		<IndexElement Pos="5" Nullable="1" attributeAddress="]ResponseType|CV.name"/>
	</IndexElements>
    <Parent Name="Experiment"/>
</ViewDefinition>
